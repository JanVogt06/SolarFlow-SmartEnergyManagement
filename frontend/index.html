<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SolarFlow Dashboard - Real-time monitoring and control of your solar energy system">

    <title>SolarFlow Dashboard - Smart Energy Management</title>

    <link rel="stylesheet" href="styles/main.css">
    <link rel="icon" href="assets/icon.png">
    <link rel="apple-touch-icon" href="assets/icon.png">

    <!-- Scripts -->
    <script src="scripts/lucide.js"></script>
    <script type="module" src="scripts/main.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <img src="assets/icon.png" alt="SolarFlow Logo" class="nav-logo">
                <span>SolarFlow Energy Manager</span>
            </div>
            <div class="nav-status">
                <div class="connection-status" id="connection-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Verbinde...</span>
                </div>
                <div class="last-update" id="last-update">--:--:--</div>
            </div>
        </div>
    </nav>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
        <div class="container">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="overview">
                    <i data-lucide="home"></i>
                    <span>Übersicht</span>
                </button>
                <button class="nav-tab" data-tab="devices">
                    <i data-lucide="cpu"></i>
                    <span>Geräte</span>
                </button>
                <button class="nav-tab" data-tab="statistics">
                    <i data-lucide="bar-chart-3"></i>
                    <span>Statistik</span>
                </button>
                <button class="nav-tab" data-tab="settings">
                    <i data-lucide="settings"></i>
                    <span>Einstellungen</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">

            <!-- Overview Tab -->
            <div class="tab-content active" id="overview-tab">
                <!-- Energy Flow Visualization -->
                <section class="energy-flow-section">
                    <div class="energy-flow-container">
                        <div class="flow-card solar">
                            <div class="flow-icon">
                                <i data-lucide="sun"></i>
                            </div>
                            <div class="flow-label">PV-Erzeugung</div>
                            <div class="flow-value" id="pv-power">-- W</div>
                        </div>

                        <div class="flow-center">
                            <div class="house-icon">
                                <i data-lucide="home"></i>
                            </div>
                            <div class="flow-label">Verbrauch</div>
                            <div class="flow-value" id="load-power">-- W</div>
                        </div>

                        <div class="flow-card grid" id="grid-card">
                            <div class="flow-icon">
                                <i data-lucide="zap"></i>
                            </div>
                            <div class="flow-label" id="grid-label">Netz</div>
                            <div class="flow-value" id="grid-power">-- W</div>
                        </div>

                        <div class="flow-card battery" id="battery-card">
                            <div class="flow-icon">
                                <i data-lucide="battery"></i>
                            </div>
                            <div class="flow-label">Batterie</div>
                            <div class="flow-value" id="battery-soc">--%</div>
                        </div>
                    </div>
                </section>

                <!-- Metrics Grid -->
                <section class="metrics-section">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-header">
                                <i data-lucide="refresh-cw" class="metric-icon"></i>
                                <span class="metric-label">Autarkie</span>
                            </div>
                            <div class="metric-value" id="autarky-rate">--%</div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <i data-lucide="piggy-bank" class="metric-icon"></i>
                                <span class="metric-label">Ersparnis heute</span>
                            </div>
                            <div class="metric-value" id="cost-saved">--€</div>
                            <div class="metric-subtext" id="total-benefit">Gesamt: --€</div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <i data-lucide="trending-up" class="metric-icon"></i>
                                <span class="metric-label">Überschuss</span>
                            </div>
                            <div class="metric-value" id="surplus-power">-- W</div>
                            <div class="metric-subtext" id="surplus-status">--</div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <i data-lucide="activity" class="metric-icon"></i>
                                <span class="metric-label">Tagesenergie</span>
                            </div>
                            <div class="metric-value" id="daily-energy">-- kWh</div>
                            <div class="metric-subtext">
                                Einspeisung: <span id="feed-in-energy">-- kWh</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Devices Tab -->
            <div class="tab-content" id="devices-tab">
                <section class="devices-section">
                    <div class="section-header">
                        <h2 class="section-title">Intelligente Gerätesteuerung</h2>
                        <div class="devices-summary">
                            <span>Aktive Geräte: <strong id="active-devices">0</strong></span>
                            <span>Gesamtverbrauch: <strong id="total-consumption">0 W</strong></span>
                        </div>
                    </div>

                    <div class="devices-grid" id="devices-grid">
                        <!-- Will be populated dynamically -->
                    </div>

                    <div class="info-box">
                        <i data-lucide="info"></i>
                        <p>Geräte werden automatisch basierend auf dem verfügbaren Überschuss gesteuert.</p>
                    </div>
                </section>
            </div>

            <!-- Statistics Tab -->
            <div class="tab-content" id="statistics-tab">
                <section class="statistics-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">PV-Produktion</div>
                            <div class="stat-value" id="stat-pv-energy">-- kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Verbrauch</div>
                            <div class="stat-value" id="stat-consumption">-- kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Eigenverbrauch</div>
                            <div class="stat-value" id="stat-self-consumption">-- kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Netzbezug</div>
                            <div class="stat-value" id="stat-grid-energy">-- kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Einspeisung</div>
                            <div class="stat-value" id="stat-feed-in">-- kWh</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ø Autarkie</div>
                            <div class="stat-value" id="stat-autarky-avg">-- %</div>
                        </div>
                    </div>

                    <div class="cost-summary-card">
                        <h3>Kostenübersicht</h3>
                        <div class="cost-row">
                            <span>Eingesparte Kosten:</span>
                            <span id="stat-cost-saved">-- €</span>
                        </div>
                        <div class="cost-row total">
                            <span>Gesamtnutzen:</span>
                            <span id="stat-total-benefit">-- €</span>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <section class="settings-section">
                    <div class="settings-card">
                        <h3>API Verbindung</h3>
                        <div class="setting-row">
                            <label for="api-url">Server URL:</label>
                            <input type="text" id="api-url" value="http://localhost:8000">
                        </div>
                        <div class="setting-row">
                            <label for="update-interval">Update Intervall:</label>
                            <select id="update-interval">
                                <option value="1000">1 Sekunde</option>
                                <option value="5000" selected>5 Sekunden</option>
                                <option value="10000">10 Sekunden</option>
                                <option value="30000">30 Sekunden</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <button class="btn btn-primary" id="save-settings">
                                <i data-lucide="save"></i>
                                Speichern
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="container">
            <div class="footer-content">
                <span>SolarFlow v1.2.0</span>
                <span class="footer-separator">•</span>
                <span>Friedrich-Schiller-Universität Jena</span>
                <span class="footer-separator">•</span>
                <span>© 2025 Jan Vogt</span>
            </div>
        </div>
    </footer>

    <!-- Connection Help Modal -->
    <div class="modal" id="connection-help-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i data-lucide="wifi-off"></i>
                    Verbindungsproblem
                </h2>
                <button class="modal-close" id="close-help-modal">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="help-section">
                    <div class="help-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Fronius API aktivieren</h3>
                            <p>Öffnen Sie die Einstellungen Ihres Fronius Wechselrichters:</p>
                            <ul class="help-list">
                                <li>Navigieren Sie zu <strong>Kommunikation → Solar API</strong></li>
                                <li>Aktivieren Sie die <strong>API-Funktion</strong></li>
                                <li>Notieren Sie sich die <strong>IP-Adresse</strong> des Wechselrichters</li>
                            </ul>
                        </div>
                    </div>

                    <div class="help-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Backend-Server starten</h3>
                            <p>Starten Sie das SolarFlow Backend mit der IP-Adresse Ihrer Fronius Anlage:</p>
                            <div class="code-block">
                                <code>python main.py --ip &lt;IP-Adresse&gt;</code>
                                <button class="copy-btn" data-copy="python main.py --ip ">
                                    <i data-lucide="copy"></i>
                                </button>
                            </div>
                            <p class="help-note">
                                <i data-lucide="info"></i>
                                Beispiel: <code>python main.py --ip 192.168.1.100</code>
                            </p>

                            <p style="margin-top: 16px;">Oder verwenden Sie die Executable:</p>
                            <div class="code-block">
                                <code>SolarFlow-windows-x64.exe --ip &lt;IP-Adresse&gt;</code>
                                <button class="copy-btn" data-copy="SolarFlow-windows-x64.exe --ip ">
                                    <i data-lucide="copy"></i>
                                </button>
                            </div>
                            <p class="help-note">
                                <i data-lucide="info"></i>
                                Beispiel: <code>SolarFlow-windows-x64.exe --ip 192.168.178.99</code>
                            </p>
                        </div>
                    </div>

                    <div class="help-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Verbindung prüfen</h3>
                            <p>Stellen Sie sicher, dass:</p>
                            <ul class="help-list">
                                <li>Der Backend-Server läuft (Port 8000)</li>
                                <li>Firewall-Einstellungen korrekt sind</li>
                                <li>Die Fronius Anlage im gleichen Netzwerk ist</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" id="retry-connection">
                        <i data-lucide="refresh-cw"></i>
                        Verbindung erneut versuchen
                    </button>
                    <button class="btn btn-primary" id="open-settings">
                        <i data-lucide="settings"></i>
                        Zu den Einstellungen
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>